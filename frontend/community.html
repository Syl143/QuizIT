<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuizIt | Dashboard</title>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/homepage.css" />
    <link rel="stylesheet" href="css/quizzes.css" />
    <link rel="stylesheet" href="css/community.css" />
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
        <div class="logo">QuizIt</div>
        <img
            src="https://img.icons8.com/?size=100&id=105515&format=png&color=FFFFFF"
            alt="Toggle Sidebar"
            class="toggle-icon"
            id="toggleSidebar"
        />
        </div>
        <ul class="menu">
            <li><a href="homepage.html"><i class="fa-solid fa-house"></i><span>Home</span></a></li>
            
            <li>
                <a href="quizzes.html">
                <img src="https://img.icons8.com/?size=100&id=rx6rZTa05YPn&format=png&color=FFFFFF" 
                    alt="Quiz Icon" class="menu-icon" />
                <span>Quizzes</span>
                </a>
            </li>
            
            <li><a href="leaderboards.html"><i class="fa-solid fa-trophy"></i><span>Leaderboards</span></a></li>
            
            <li class="active"><a href="community.html"><i class="fa-solid fa-comments"></i><span>Community</span></a></li>
            
            <li><a href="profile.html"><i class="fa-solid fa-user"></i><span>Profile</span></a></li>
        </ul>
        <div class="logout" onclick="logout()">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>Logout</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
    <header>
        <div class="tabs">
            <button class="tab active" data-tab="discussions">Discussions</button>
            <button class="tab" data-tab="my-feed">My Feed</button>
        </div>
      <div class="profile-card">
        <img
          src="https://img.icons8.com/color/96/000000/user-male-circle--v1.png"
          alt="Profile"
        />
        <div class="profile-info">
          <h3>User Name</h3>
          <p>BSIT Student</p>
        </div>
      </div>
    </header>

    <section id="discussions-section" class="section">
    <!-- Main Discussions Feed -->
        <div class="discussion-main">
            <!-- New Post -->
            <div class="new-post">
                <div class="new-post-header">
                    <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" class="user-icon" />
                    <input type="text" id="new-post-title" placeholder="Post title..." />
                </div>
            <input type="text" id="new-post-text" placeholder="Share your thoughts..." />
            <button id="post-btn"><i class="fa-solid fa-paper-plane"></i> Post</button>
        </div>

        <!-- Premade Discussion Card -->
        <div class="discussion-card" data-votes="12">
            <div class="vote-panel">
                <button class="vote-btn upvote">‚¨Ü</button>
                <span class="vote-count">12</span>
                <button class="vote-btn downvote">‚¨á</button>
            </div>
            <div class="post-content">
                <h3>How do I improve my quiz scores?</h3>
                <p>
                    <img src="https://img.icons8.com/color/24/000000/user-female-circle.png" class="user-icon-small" />
                    <strong>Alice:</strong> I recommend doing daily mini quizzes and reviewing missed answers!
                </p>
                <div class="post-actions">
                    <span class="comments-toggle">üí¨ 1 Comment</span>
                    <span>üïí 2h ago</span>
                </div>

                <!-- Comments Section -->
                <div class="comments-section hidden">
                    <div class="comment">
                        <img src="https://img.icons8.com/color/24/000000/user-male-circle--v1.png" class="user-icon-small" />
                        <strong>You:</strong> Thanks, great advice!
                    </div>
                    <div class="reply-input-container">
                        <input type="text" class="reply-input" placeholder="Write a reply..." />
                        <button class="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add more discussion cards as needed -->
        </div>

        <!-- Trending Topics Sidebar -->
        <aside id="trending-topics">
            <h3>üî• Trending Topics</h3>
            <ul class="trending-list">
            <li>
                <span class="topic-tag">#QuizTips</span>
                <span class="topic-title">How to ace timed quizzes?</span>
                <span class="topic-count">12k üî•</span>
            </li>
            <li>
                <span class="topic-tag">#AI</span>
                <span class="topic-title">Play vs AI strategies</span>
                <span class="topic-count">8k üî•</span>
            </li>
            <!-- more topics -->
            </ul>
        </aside>
    </section>



<!-- My Feed Section -->
<section id="feed-section" class="section">
  
  <!-- New Feed Post Box -->
  <div class="feed-new-post">
    <div class="feed-post-header">
      <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User" class="feed-user-icon">
      <input type="text" id="feed-new-text" placeholder="What's on your mind?" />
    </div>

    <div class="feed-post-attachments">
      <label>
        <i class="fa-solid fa-image"></i>
        <input type="file" id="feed-image-upload" accept="image/*" hidden>
      </label>
      <label>
        <i class="fa-solid fa-video"></i>
        <input type="file" id="feed-video-upload" accept="video/*" hidden>
      </label>
      <label>
        <i class="fa-solid fa-link"></i>
        <input type="url" id="feed-link-input" placeholder="Paste link..." />
      </label>
    </div>

    <button id="feed-post-btn"><i class="fa-solid fa-paper-plane"></i> Post</button>
  </div>

  <!-- Feed Posts -->
  <div id="feed-posts-container">
    <!-- Example Feed Post -->
    <div class="feed-post-card">
      <div class="feed-post-header">
        <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User" class="feed-user-icon">
        <div>
          <h4 class="feed-user-name">Diana</h4>
          <p class="feed-timestamp">2 hours ago</p>
        </div>
      </div>

      <p class="feed-post-content">Just completed the ‚ÄúPython Basics‚Äù quiz! Learned so much!</p>

      <div class="feed-post-actions">
        <div class="feed-left-actions">
          <button class="feed-like-btn"><i class="fa-solid fa-thumbs-up"></i> Like <span class="feed-like-count">0</span></button>
          <button class="feed-dislike-btn"><i class="fa-solid fa-thumbs-down"></i> Dislike <span class="feed-dislike-count">0</span></button>
          <button class="feed-comment-btn"><i class="fa-solid fa-comment"></i> Comment</button>
        </div>
        <button class="feed-share-btn"><i class="fa-solid fa-share"></i> Share</button>
      </div>

      <!-- Comment Section -->
      <div class="feed-comment-section hidden">
        <div class="feed-comment-input">
          <input type="text" class="feed-comment-text" placeholder="Write a comment..." />
          <button class="feed-comment-send"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
        <div class="feed-comment-list"></div>
      </div>
    </div>
  </div>

</section>
    

    <footer>¬© 2025 QuizIt ‚Äî All Rights Reserved</footer>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ================== CONFIG ==================
  const BASE_URL = window.location.hostname.includes("localhost")
    ? "http://localhost:3000/posts"
    : "https://quizit-backend-bql1.onrender.com/posts";

  const USER_KEY = "loggedInUser";

  // ================== ELEMENTS ==================
  const postForm = document.getElementById("postForm");
  const postContent = document.getElementById("postContent");
  const postFeed = document.getElementById("postFeed");

  // ================== CURRENT USER ==================
  const loggedInUser = JSON.parse(sessionStorage.getItem(USER_KEY));
  if (!loggedInUser) {
    alert("Please log in to access the community page.");
    window.location.href = "index.html";
    return;
  }

  console.log("üë§ Logged in as:", loggedInUser.fullname);

  // ================== LOAD POSTS ==================
  async function loadPosts() {
    try {
      const response = await fetch(BASE_URL, { cache: "no-cache" });
      if (!response.ok) throw new Error("Failed to fetch posts");
      const posts = await response.json();
      renderPosts(posts.reverse()); // Show newest first
    } catch (err) {
      console.error("Error loading posts:", err);
      postFeed.innerHTML = "<p class='error'>‚ö†Ô∏è Failed to load posts.</p>";
    }
  }

  // ================== RENDER POSTS ==================
  function renderPosts(posts) {
    postFeed.innerHTML = "";

    if (!posts.length) {
      postFeed.innerHTML = "<p class='empty'>No posts yet. Be the first!</p>";
      return;
    }

    posts.forEach((post) => {
      const div = document.createElement("div");
      div.classList.add("post");

      div.innerHTML = `
        <div class="post-header">
          <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User">
          <div>
            <h4>${post.author}</h4>
            <p class="timestamp">${new Date(post.date).toLocaleString()}</p>
          </div>
        </div>
        <div class="post-body">
          <p>${post.content}</p>
        </div>
        <div class="post-actions">
          <button class="like-btn">‚ù§Ô∏è ${post.likes || 0}</button>
          <button class="comment-btn">üí¨ ${post.comments ? post.comments.length : 0}</button>
        </div>
      `;

      postFeed.appendChild(div);

      // Optional: local like functionality
      const likeBtn = div.querySelector(".like-btn");
      likeBtn.addEventListener("click", () => {
        post.likes = (post.likes || 0) + 1;
        likeBtn.textContent = `‚ù§Ô∏è ${post.likes}`;
      });
    });
  }

  // ================== ADD POST ==================
  postForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const content = postContent.value.trim();
    if (!content) return alert("Please write something before posting.");

    const newPost = {
      author: loggedInUser.fullname,
      content,
      date: new Date().toISOString(),
      likes: 0,
      comments: [],
    };

    try {
      const response = await fetch(BASE_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newPost),
      });

      if (!response.ok) throw new Error("Failed to post");

      postContent.value = "";
      await loadPosts(); // refresh feed
    } catch (err) {
      console.error("Post error:", err);
      alert("Something went wrong while posting.");
    }
  });

  // ================== INIT ==================
  loadPosts();
});
</script>



</body>
</html>
