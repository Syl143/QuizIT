<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuizIt | Dashboard</title>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/homepage.css" />
    <link rel="stylesheet" href="css/quizzes.css" />
    <link rel="stylesheet" href="css/community.css" />
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
        <div class="logo">QuizIt</div>
        <img
            src="https://img.icons8.com/?size=100&id=105515&format=png&color=FFFFFF"
            alt="Toggle Sidebar"
            class="toggle-icon"
            id="toggleSidebar"
        />
        </div>
        <ul class="menu">
            <li><a href="homepage.html"><i class="fa-solid fa-house"></i><span>Home</span></a></li>
            
            <li>
                <a href="quizzes.html">
                <img src="https://img.icons8.com/?size=100&id=rx6rZTa05YPn&format=png&color=FFFFFF" 
                    alt="Quiz Icon" class="menu-icon" />
                <span>Quizzes</span>
                </a>
            </li>
            
            <li><a href="leaderboards.html"><i class="fa-solid fa-trophy"></i><span>Leaderboards</span></a></li>
            
            <li class="active"><a href="community.html"><i class="fa-solid fa-comments"></i><span>Community</span></a></li>
            
            <li><a href="profile.html"><i class="fa-solid fa-user"></i><span>Profile</span></a></li>
        </ul>
        <div class="logout" onclick="logout()">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>Logout</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
    <header>
        <div class="tabs">
            <button class="tab active" data-tab="discussions">Discussions</button>
            <button class="tab" data-tab="my-feed">My Feed</button>
        </div>
      <div class="profile-card">
        <img
          src="https://img.icons8.com/color/96/000000/user-male-circle--v1.png"
          alt="Profile"
        />
        <div class="profile-info">
          <h3>User Name</h3>
          <p>BSIT Student</p>
        </div>
      </div>
    </header>

    <section id="discussions-section" class="section">
    <!-- Main Discussions Feed -->
        <div class="discussion-main">
            <!-- New Post -->
            <div class="new-post">
                <div class="new-post-header">
                    <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" class="user-icon" />
                    <input type="text" id="new-post-title" placeholder="Post title..." />
                </div>
            <input type="text" id="new-post-text" placeholder="Share your thoughts..." />
            <button id="post-btn"><i class="fa-solid fa-paper-plane"></i> Post</button>
        </div>

        <!-- Premade Discussion Card -->
        <div class="discussion-card" data-votes="12">
            <div class="vote-panel">
                <button class="vote-btn upvote">‚¨Ü</button>
                <span class="vote-count">12</span>
                <button class="vote-btn downvote">‚¨á</button>
            </div>
            <div class="post-content">
                <h3>How do I improve my quiz scores?</h3>
                <p>
                    <img src="https://img.icons8.com/color/24/000000/user-female-circle.png" class="user-icon-small" />
                    <strong>Alice:</strong> I recommend doing daily mini quizzes and reviewing missed answers!
                </p>
                <div class="post-actions">
                    <span class="comments-toggle">üí¨ 1 Comment</span>
                    <span>üïí 2h ago</span>
                </div>

                <!-- Comments Section -->
                <div class="comments-section hidden">
                    <div class="comment">
                        <img src="https://img.icons8.com/color/24/000000/user-male-circle--v1.png" class="user-icon-small" />
                        <strong>You:</strong> Thanks, great advice!
                    </div>
                    <div class="reply-input-container">
                        <input type="text" class="reply-input" placeholder="Write a reply..." />
                        <button class="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add more discussion cards as needed -->
        </div>

        <!-- Trending Topics Sidebar -->
        <aside id="trending-topics">
            <h3>üî• Trending Topics</h3>
            <ul class="trending-list">
            <li>
                <span class="topic-tag">#QuizTips</span>
                <span class="topic-title">How to ace timed quizzes?</span>
                <span class="topic-count">12k üî•</span>
            </li>
            <li>
                <span class="topic-tag">#AI</span>
                <span class="topic-title">Play vs AI strategies</span>
                <span class="topic-count">8k üî•</span>
            </li>
            <!-- more topics -->
            </ul>
        </aside>
    </section>



<!-- My Feed Section -->
<section id="feed-section" class="section">
  
  <!-- New Feed Post Box -->
  <div class="feed-new-post">
    <div class="feed-post-header">
      <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User" class="feed-user-icon">
      <input type="text" id="feed-new-text" placeholder="What's on your mind?" />
    </div>

    <div class="feed-post-attachments">
      <label>
        <i class="fa-solid fa-image"></i>
        <input type="file" id="feed-image-upload" accept="image/*" hidden>
      </label>
      <label>
        <i class="fa-solid fa-video"></i>
        <input type="file" id="feed-video-upload" accept="video/*" hidden>
      </label>
      <label>
        <i class="fa-solid fa-link"></i>
        <input type="url" id="feed-link-input" placeholder="Paste link..." />
      </label>
    </div>

    <button id="feed-post-btn"><i class="fa-solid fa-paper-plane"></i> Post</button>
  </div>

  <!-- Feed Posts -->
  <div id="feed-posts-container">
    <!-- Example Feed Post -->
    <div class="feed-post-card">
      <div class="feed-post-header">
        <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User" class="feed-user-icon">
        <div>
          <h4 class="feed-user-name">Diana</h4>
          <p class="feed-timestamp">2 hours ago</p>
        </div>
      </div>

      <p class="feed-post-content">Just completed the ‚ÄúPython Basics‚Äù quiz! Learned so much!</p>

      <div class="feed-post-actions">
        <div class="feed-left-actions">
          <button class="feed-like-btn"><i class="fa-solid fa-thumbs-up"></i> Like <span class="feed-like-count">0</span></button>
          <button class="feed-dislike-btn"><i class="fa-solid fa-thumbs-down"></i> Dislike <span class="feed-dislike-count">0</span></button>
          <button class="feed-comment-btn"><i class="fa-solid fa-comment"></i> Comment</button>
        </div>
        <button class="feed-share-btn"><i class="fa-solid fa-share"></i> Share</button>
      </div>

      <!-- Comment Section -->
      <div class="feed-comment-section hidden">
        <div class="feed-comment-input">
          <input type="text" class="feed-comment-text" placeholder="Write a comment..." />
          <button class="feed-comment-send"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
        <div class="feed-comment-list"></div>
      </div>
    </div>
  </div>

</section>
    

    <footer>¬© 2025 QuizIt ‚Äî All Rights Reserved</footer>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  // ----- CONFIG -----
  const API_BASE = "http://localhost:3000";
const USERS_ENDPOINT = `${API_BASE}/users`;;
  const LESSONS_PATH = "data/lessons.json";
  const LOCAL_USERS_KEY = "quizit_local_users";

  const qs = sel => document.querySelector(sel);
  const qsa = sel => Array.from(document.querySelectorAll(sel));

  // ----- TAB SWITCHING -----
const tabs = document.querySelectorAll('.tab');
const sections = {
  discussions: document.getElementById('discussions-section'),
  'my-feed': document.getElementById('feed-section')
};

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    // Toggle active class on tabs
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    // Show only the corresponding section
    Object.values(sections).forEach(sec => sec.classList.remove('active'));
    sections[tab.dataset.tab].classList.add('active');
  });
});

// Initialize default section
sections['discussions'].classList.add('active');


  // ----- SESSION CHECK -----
  const sessionUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
  if (!sessionUser) {
    alert("Please log in first.");
    window.location.href = "index.html";
    return;
  }

  // ----- LOAD USERS -----
let users = [];
try {
  const res = await fetch(USERS_ENDPOINT); // GET all users
  if (!res.ok) throw new Error("json-server not available");
  users = await res.json();
} catch (err) {
  console.warn("json-server unavailable, falling back to localStorage...");
  const stored = localStorage.getItem(LOCAL_USERS_KEY);
  users = stored ? JSON.parse(stored) : [];
}

// Find logged-in user
let user = users.find(u => u.email === sessionUser.email);
if (!user) {
  alert("User not found.");
  sessionStorage.clear();
  window.location.href = "index.html";
  return;
}

  // ----- ELEMENTS -----
  const profileNameEl = qs(".profile-info h3");

  // ----- RENDER FUNCTIONS -----
  function renderProfile() {
    profileNameEl.textContent = user.fullname;
    updateXP();
  }

  // ----- INITIALIZE -----
  renderProfile();

  // ----- LOGOUT -----
  window.logout = function() {
    sessionStorage.clear();
    window.location.href = "index.html";
  };

const sidebar = document.querySelector('.sidebar');
  const toggleBtn = document.getElementById('toggleSidebar');

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
  });
});

document.addEventListener("DOMContentLoaded", () => {
  const postBtn = document.getElementById("post-btn");
  const newPostText = document.getElementById("new-post-text");
  const newPostTitle = document.getElementById("new-post-title");
  const postsContainer = document.getElementById("discussions-section");

  // Initialize post events
  function initPosts() {
    // Toggle comments
    document.querySelectorAll(".comments-toggle").forEach(btn => {
      btn.onclick = () => {
        const card = btn.closest(".discussion-card");
        const comments = card.querySelector(".comments-section");
        comments.classList.toggle("hidden");
      };
    });

    // Send comment
    document.querySelectorAll(".send-btn").forEach(btn => {
      btn.onclick = () => {
        const container = btn.closest(".discussion-card");
        const input = btn.closest(".reply-input-container").querySelector(".reply-input");
        const commentsSection = container.querySelector(".comments-section");

        if (input.value.trim() === "") return;

        const newComment = document.createElement("div");
        newComment.className = "comment";
        newComment.innerHTML = `
          <img src="https://img.icons8.com/color/24/000000/user-male-circle--v1.png" class="user-icon-small" />
          <strong>You:</strong> ${input.value}
        `;
        commentsSection.insertBefore(newComment, btn.closest(".reply-input-container"));

        // Update comment count
        const toggle = container.querySelector(".comments-toggle");
        const currentCount = container.querySelectorAll(".comment").length;
        toggle.textContent = `üí¨ ${currentCount} Comment${currentCount > 1 ? "s" : ""}`;

        input.value = "";
      };
    });

    // Upvote / downvote
    document.querySelectorAll(".upvote, .downvote").forEach(btn => {
      btn.onclick = () => {
        const card = btn.closest(".discussion-card");
        const countEl = card.querySelector(".vote-count");
        let count = parseInt(countEl.textContent);
        if (btn.classList.contains("upvote")) count++;
        if (btn.classList.contains("downvote")) count--;
        countEl.textContent = count;
      };
    });
  }

  // Create new post
  postBtn.onclick = () => {
    const title = newPostTitle.value.trim() || "New Post";
    const content = newPostText.value.trim();

    if (!title && !content) return;

    const newCard = document.createElement("div");
    newCard.className = "discussion-card";
    newCard.dataset.votes = 0;
    newCard.innerHTML = `
      <div class="vote-panel">
        <button class="vote-btn upvote">‚¨Ü</button>
        <span class="vote-count">0</span>
        <button class="vote-btn downvote">‚¨á</button>
      </div>
      <div class="post-content">
        <h3>${title}</h3>
        <p>
          <img src="https://img.icons8.com/color/24/000000/user-male-circle--v1.png" class="user-icon-small" />
          <strong>You:</strong> ${content}
        </p>
        <div class="post-actions">
          <span class="comments-toggle">üí¨ 0 Comments</span>
          <span>üïí just now</span>
        </div>
        <div class="comments-section hidden">
          <div class="reply-input-container">
            <input type="text" class="reply-input" placeholder="Write a reply..." />
            <button class="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
          </div>
        </div>
      </div>
    `;

    // Append below the post box instead of prepending
    postsContainer.appendChild(newCard);

    // Clear inputs
    newPostTitle.value = "";
    newPostText.value = "";

    // Re-initialize event listeners for new post
    initPosts();
  };

  // Initialize existing posts
  initPosts();
});

document.addEventListener("DOMContentLoaded", () => {
  const feedNewText = document.getElementById("feed-new-text");
  const feedImageUpload = document.getElementById("feed-image-upload");
  const feedVideoUpload = document.getElementById("feed-video-upload");
  const feedLinkInput = document.getElementById("feed-link-input");
  const feedPostBtn = document.getElementById("feed-post-btn");
  const feedPostsContainer = document.getElementById("feed-posts-container");

  // Helper to create a new feed post
  function createFeedPost(content, imageSrc = "", videoSrc = "", linkUrl = "") {
    const postCard = document.createElement("div");
    postCard.className = "feed-post-card";

    postCard.innerHTML = `
      <div class="feed-post-header">
        <img src="https://img.icons8.com/color/48/000000/user-male-circle--v1.png" alt="User" class="feed-user-icon">
        <div>
          <h4 class="feed-user-name">You</h4>
          <p class="feed-timestamp">just now</p>
        </div>
      </div>
      <p class="feed-post-content">${content}</p>
      ${imageSrc ? `<img src="${imageSrc}" alt="Post Image" style="max-width:100%; border-radius:8px;">` : ""}
      ${videoSrc ? `<video src="${videoSrc}" controls style="max-width:100%; border-radius:8px;"></video>` : ""}
      ${linkUrl ? `<a href="${linkUrl}" target="_blank">${linkUrl}</a>` : ""}
      <div class="feed-post-actions">
        <div class="feed-left-actions">
          <button class="feed-like-btn"><i class="fa-solid fa-thumbs-up"></i> Like <span class="feed-like-count">0</span></button>
          <button class="feed-dislike-btn"><i class="fa-solid fa-thumbs-down"></i> Dislike <span class="feed-dislike-count">0</span></button>
          <button class="feed-comment-btn"><i class="fa-solid fa-comment"></i> Comment</button>
        </div>
        <button class="feed-share-btn"><i class="fa-solid fa-share"></i> Share</button>
      </div>
      <div class="feed-comment-section hidden">
        <div class="feed-comment-input">
          <input type="text" class="feed-comment-text" placeholder="Write a comment..." />
          <button class="feed-comment-send"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
        <div class="feed-comment-list"></div>
      </div>
    `;

    // Attach event listeners
    attachFeedPostEvents(postCard);

    return postCard;
  }

  // Attach events for like, dislike, comment, and send
  function attachFeedPostEvents(postCard) {
    const likeBtn = postCard.querySelector(".feed-like-btn");
    const dislikeBtn = postCard.querySelector(".feed-dislike-btn");
    const commentBtn = postCard.querySelector(".feed-comment-btn");
    const shareBtn = postCard.querySelector(".feed-share-btn");
    const commentSection = postCard.querySelector(".feed-comment-section");
    const commentSendBtn = postCard.querySelector(".feed-comment-send");
    const commentInput = postCard.querySelector(".feed-comment-text");
    const likeCountEl = postCard.querySelector(".feed-like-count");
    const dislikeCountEl = postCard.querySelector(".feed-dislike-count");

    let likes = 0, dislikes = 0;

    likeBtn.addEventListener("click", () => {
      if (!likeBtn.classList.contains("active")) {
        likes++;
        likeBtn.classList.add("active");
        dislikeBtn.classList.remove("active");
        if (dislikes > 0) dislikes--;
      } else {
        likes--;
        likeBtn.classList.remove("active");
      }
      likeCountEl.textContent = likes;
      dislikeCountEl.textContent = dislikes;
    });

    dislikeBtn.addEventListener("click", () => {
      if (!dislikeBtn.classList.contains("active")) {
        dislikes++;
        dislikeBtn.classList.add("active");
        likeBtn.classList.remove("active");
        if (likes > 0) likes--;
      } else {
        dislikes--;
        dislikeBtn.classList.remove("active");
      }
      likeCountEl.textContent = likes;
      dislikeCountEl.textContent = dislikes;
    });

    commentBtn.addEventListener("click", () => {
      commentSection.classList.toggle("hidden");
    });

    shareBtn.addEventListener("click", () => {
      alert("Post shared!");
    });

    commentSendBtn.addEventListener("click", () => {
      const text = commentInput.value.trim();
      if (!text) return;
      const commentList = postCard.querySelector(".feed-comment-list");
      const newComment = document.createElement("div");
      newComment.className = "feed-comment";
      newComment.textContent = text;
      commentList.appendChild(newComment);
      commentInput.value = "";
    });
  }

  // Handle new post button click
  feedPostBtn.addEventListener("click", () => {
    const text = feedNewText.value.trim();
    if (!text) return;

    // Handle image/video/link files
    let imageSrc = "", videoSrc = "", linkUrl = feedLinkInput.value.trim();

    if (feedImageUpload.files.length > 0) {
      imageSrc = URL.createObjectURL(feedImageUpload.files[0]);
    }

    if (feedVideoUpload.files.length > 0) {
      videoSrc = URL.createObjectURL(feedVideoUpload.files[0]);
    }

    const newPost = createFeedPost(text, imageSrc, videoSrc, linkUrl);
    feedPostsContainer.prepend(newPost);

    // Clear inputs
    feedNewText.value = "";
    feedLinkInput.value = "";
    feedImageUpload.value = "";
    feedVideoUpload.value = "";
  });
    // ----- LOGOUT -----
  window.logout = function() {
    sessionStorage.clear();
    window.location.href = "index.html";
  };
});
const sidebar = document.querySelector('.sidebar');
  const toggleBtn = document.getElementById('toggleSidebar');

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
  });

</script>


</body>
</html>
